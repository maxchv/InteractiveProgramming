# Неделя 3 - Локальные и глобальные переменные, создание проекта на phaser, сцена, отрисовка объектов

Изучаются основные отличия между локальными и глобальными переменными, создание проекта используя `JavaScript` библиотеку `Phaser 3`, основы отрисовки игровых объектов на сцене

## Лоакльные и глобальные переменные

`Локальные` переменные - переменные, доступ к которым может быть осуществлен только в определенном блоке кода.

Примером может служить объявление локальной переменной `image` внутри функции `load()`:

```JavaScript
function load() {
    var image = 'dog.png';
    console.log(image);
}
load();
```

При вызове этой функции мы увидим в консоли сообщение: `dog.png`.

Однако обратиться к переменной `image` в другой функции будет невозможно.

В этом примере доступ к переменной `image` возможен только внутри функции `load()`, поэтом при выполнении кода возникнет ошибка:

```JavaScript
function load() {
    var image = 'dog.png';
}
function create() {
    console.log(image);
}
load();
create();
```

В отличии от `локальных` переменых, к `глобальным` переменным доступ может быть осуществлен в любом месте программы.

Для того, что бы приведенный выше код выполнился правильно, то переменную `image` следует сделать глобальной:

```JavaScript

var image;

function load() {
    image = 'dog.png';
}
function create() {
    console.log(image);
}
load();
create();
```

## Игровой дивижок phaser.io

`Phaser.js` - это игровая библиотека на `JavaScript` предназначенный для создания игр в вебе!

Главная страница библиотеки: [phaser.io](http://phaser.io)

`Phaser` предоставляет нам готовые компоненты для быстрого старта и избавляет нас от необходимости создания игр полностью с нуля. 

В этом уроке мы рассмотрим следующие темы:

* Рисование фигур, загрузка и отображение изображений
* Воспроизведение звука и музыки
* Добавление реалистичной анимации
* Работа с компьютерной мышью

Также мы рассмотрим создание базового проекта на `Phaser`.

В наших уроках речь будет идти о `Phaser 3`, старая версия Phaser (более известная как Phaser 2/Phaser CE) не подходит.

### Создание базового проекта

Прежде, чем начать создавать нашу первую игру давайте создадим базовую структуру проекта.
Для этого выберете любую папку на вашем компьютере, в которую вы будете хранить все ваши проекты.

Предположим, что это будет папка `c:\projects`.
Внутри этой папки создайте папку с названием `firstGame`.
В папке `firstGame` необходимо создать еще папку `js` и `img`. Первая будет служить папкой содержащая скрипты `JavaScript`, а во вторую будем складывать изображения для нашей игры.

Внутри папки вашего проекта `firstGame` необходимо создать файл `index.html` со следующим содержимым:

```html
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Game</title>
</head>

<body>
  <script src="./js/phaser.min.js"></script>
  <script src="./js/game.js"></script>
</body>

</html>
```

В папку `js` проекта необходимо поместить файл `phaser.min.js`, который можно загрузить по адресу: [https://github.com/photonstorm/phaser/releases/download/v3.21.0/phaser.min.js](https://github.com/photonstorm/phaser/releases/download/v3.21.0/phaser.min.js)

Также в папке `js` нужно создать главный файл `game.js`, в котором мы будем писать свою игру.
Сейчас мы создадим заготовку для будущей игры:

```JavaScript
const config = {
  type: Phaser.AUTO,
  backgroundColor: 0xffffff,
  width: 450,
  height: 600
};

const game = new Phaser.Game(config);

function create() {
    console.log('create game');
}
```

Пример создания проекта:

![create project](img/start.gif)

### Настройки (конфигурирование) игры

В `Phaser` для создания игры необходимо создать объект `GameObjects`. 
Для этого необходимо вызвать `new Phaser.Game()`. 

`Phaser.Game()` позволяет создать `<canvas>` элемент и добавить его в HTML документ. 
Этот элемент позволяет `Phaser` рисовать спрайты и фигуры.

При создании игры нам необходимо задать дополнительную информацию - конфигруацию.
Для этого создается объект `config` в которм задаются следующие аттрибуты:

* `height`: высота элемента `<canvas>` в пикселях, котоый создает `Phaser`.
* `width`: ширина элемента `<canvas>` в пикселях, котоый создает `Phaser`.
* `backgroundColor`: цвет фона игровой сцены, обычно задается в шестнадацатиричном виде. Например, `0xff0000` - красный, `0x00ff00` - зеленый или `0xffffff` - белый.
* `type`: рендер, который будет использовать `Phaser`. Можеть быть `Phaser.WEBGL`, которые предоставлят дополнительные функции при отрисовке или `Phaser.CANVAS`, который подходим большинству браузеров. Значение по умолчанию `Phaser.AUTO` позволяет выбрать режим `WebGL` в случае, если он поддерживается браузерем или `canvas`, в противном случае.

Существует много других настроек нашей игры, но это основные и их достаточно для создания простейшей игры. 
Все возможные варианты можно найти в документации `Phaser`: [GameConfig](https://photonstorm.github.io/phaser3-docs/Phaser.Types.Core.html#.GameConfig)

Отлично, мы создали холст определенного размера и цвета, на котором будет отрисовываться игровая сцена и игровые объекты, 
но где будет описана логика игры?

### Сцена

Игры в `Phaser` состоят из игровых сцен (`Scenes`), которые необходимо определить и передать в настройках `Phaser`! 
Сцена может иметь следующие функции:

* `preload()` - загружаем внешние файлы (или `assets`) в нашу игру. Вызывается один раз. 
* `create()` - здесь мы определяем игровые объекты `GameObjects`, которые нобходимы для старта нашей игры. Вызывается один раз. 
* `update()` - здесь мы реализуем анимацию и взаимодействие в нашей игре. Вызывается не менее 60 раз в секунду.

При создании сцены (`Scene`) мы реализуем только те функции, которые нам действительно нужны в игре. 

Таким образом, если нам не нужно загружать внешние файлы в игру, то и функця `preload()` нам не нужна.

После того, как эти функции объявлены мы указываем их в настроках `Phaser`! 

Пример ример:

```JavaScript
function preload() {
  this.load.image('codey', 'assets/images/codey.png');
}

function create() {
  this.add.image('codey', 130, 100);
}

const config = {
  width: 300px,
  height: 600px,

  scene: {
    preload,
    create
  }
};
```

В примере выше мы создали функции `preload()` и `create()` для нашей игровой сцены (`Scene`). 
Объект `this` на оторый мы ссылались в этих методах ссылается на объект сцены (`Scene`)! 

Объекты `this.load `и `this.add` являются вспомогательными библиотеками для сцены (`Scene`), чьи методы (например, `this.load.image()` и `this.add.circle()`) позволяют нам загружать внешние файлы и создавать игровые объекты.

В настройках игры (в `config`) мы добавили новый ключ (аттрибут) `scene`, которому присвоили объект (в фигурных скобках).

Этот объект повзоляет привязать функцию `preload()` и `create()` к нашей сцене. 

Примечание: в примере выше мы используем сокращенную форму задания ключей-значений, которая принята в `JavaScript`.
Такой вариант также сработает:

```JavaScript
{ 
    preload: preload, 
    create: create 
}
```

### Перемещение игровых объектов

Настало время добавить движение в нашу игру на `Phaser`! 

Для этого нам необходимо добавить еще одну функцию `update()` в нашу сцену (`Scene`) в котором можем реализовать движение, анимацию и взаимодействие игровых объектов! 

Мы начнем с очень простого примера: движение игрового объекта по сцене. 

Если мы создаем игровой объект (`GameObject`) с центром в точке (0, 100), то это означает, что коорданата `x = 0`, а  `y = 100`. Мы можем перемещать игровой объект в функции `update()`:

```JavaScript
let circle; // объявляем глобальную переменную circle

function create() {
  // создаем красный (0xff0000) круг с радиусом 20 в точке (0, 100)
  circle = this.add.circle(0, 100, 20, 0xff0000);
}

function update() {
  // переместим круг вправо на 1 пиксель
  circle.x += 1;
}
```

В первую очередь объявим глобальную переменную `circle` т.к. нам необходимо ссылаться на один и тот же объект в разных функциях (`create()` и `update()`). 
Существует несколько способов обратиться к одному объекту в разных функциях, но для небольших игровых проектов решение через глобальные объекты можно считать достаточным.

После этого в функции `create()` мы присвоили новый игровой объект (`GameObject`) глобальной переменной `circle` используя метод `this.add.circle()` с передачей аргументов `x`, `y`, `radius` и `fillColor`. 
Детально о методе `circle()` можно почитеть в [документации](https://photonstorm.github.io/phaser3-docs/Phaser.GameObjects.GameObjectFactory.html#circle__anchor)

В функции `update()` мы обновляем значение координаты `x` для круга. 

Функция `update()` имеет два необязательных параметра: время (`time`) и разница времени (`delta`) [документация](https://photonstorm.github.io/phaser3-docs/Phaser.Scene.html#update__anchor).

Первый параметер содержит время в миллисекундах с момента старта игры, второй - разнуцу во времени (в миллисекундах) с момента последнего вызова функции `update()`. 

`Phaser` вызывает функцию `update()` 60 в секунду (60 fps), таким образом `delta` равна `16.6`. 
Этого вполне достаточно для нас, поэтому мы будем использовать функцию `update()` без параметров.

## Вопросы

1. Сколько раз вызывается метод `create()` объекта `Scene`?
2. Как часто вызывается метод update() объекта `Scene`?
3. Укажите в какой последовательности вызываются методы `update()`, `create()` и `preload()`?
4. Какая функция позволяет выполнить предварительную загрузку файлов для игры?
5. Какая функция используется для создания игровых объектов?
6. Какая функция позволяет переместить игровой объект?
7. Какой аттрибут настроек игры (объект `config`) позволяет задать ширину сцены?
8. Какой аттрибут настроек игры (объект `config`) позволяет задать высоту сцены?
9. Как можно задать цвет фона игровой сцены?
10. Какой цвет представлен значением `0x0000ff`?
11. Как задать белый цвет игровой сцены?

## Ссылки

* [Scene](https://photonstorm.github.io/phaser3-docs/Phaser.Scene.html)
* []()